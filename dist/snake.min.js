!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(n="undefined"!=typeof globalThis?globalThis:n||self).Snake=t()}(this,(function(){"use strict";var n=1,t=2,e=3,o=4,r={rows:30,columns:40};var i=0,a=function(){function n(n,t){this.x=n,this.y=t,this.uid=i++,this.node=null,this.oldClass="snake-map__col",this.class=this.oldClass,this.update()}var t=n.prototype;return t.render=function(){if(!this.node){var n=d();n.classList.add(this.oldClass),n.setAttribute("id",this.x+"_"+this.y),this.node=n}return this.node},t.update=function(){this.oldClass!==this.class&&(this.render().classList=this.class,this.oldClass=this.class)},t.addSnakeColor=function(){this.class="snake-map__col snake-map__col--snake"},t.addSnakeHeadColor=function(){this.class="snake-map__col snake-map__col--snake-head"},t.addFoodColor=function(){this.class="snake-map__col snake-map__col--food"},t.removeClass=function(){this.class="snake-map__col"},n}();function s(n){return"string"==typeof n}function u(n,t){t=t||0;for(var e=n.length-t,o=new Array(e);e--;)o[e]=n[e+t];return o}function c(n){return n instanceof a}function d(n){return void 0===n&&(n="div"),s(n)&&n.length?document.createElement(n):null}function f(n,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}function l(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,o=new Array(t);e<t;e++)o[e]=n[e];return o}function p(n,t){var e="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(e)return(e=e.call(n)).next.bind(e);if(Array.isArray(n)||(e=function(n,t){if(n){if("string"==typeof n)return l(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(n,t):void 0}}(n))||t&&n&&"number"==typeof n.length){e&&(n=e);var o=0;return function(){return o>=n.length?{done:!0}:{done:!1,value:n[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h=function(n,t,e){void 0===e&&(e=null),this.id=n,this.data=t,this.next=e},_=function(){function n(){this.head=null,this.tail=null}var t,e,o,r=n.prototype;return r.append=function(n,t){var e=new h(n,t);this.tail&&(this.tail.next=e),this.head||(this.head=e),this.tail=e},r.prepend=function(n,t){var e=new h(n,t,this.head);this.head=e,this.tail||(this.tail=e)},r.find=function(n,t){if(void 0===t&&(t=null),!this.head||"function"!=typeof n)return null;for(var e=this.head;e;){try{if(n.apply(t,[e.data,e.id]))return e.data}catch(n){console.error(n)}e=e.next}return null},r.toArray=function(){var n=[];return this.for((function(t){n.push(t)}),this),n},r.for=function(n,t){if(void 0===t&&(t=null),this.head&&"function"==typeof n)for(var e=this.head;e;){try{n.apply(t,[e.data,e.id])}catch(n){console.error(n)}e=e.next}},r.filter=function(n,t){void 0===t&&(t=null);var e=[];if("function"!=typeof n)return e;for(var o=this.head;o;){try{n.apply(t,[o.data,o.id])&&e.push(o.data)}catch(n){console.error(n)}o=o.next}return e},r.remove=function(n){if(this.head){for(;this.head&&this.head.id===n;)this.head=this.head.next;for(var t=this.head;t&&t.next;)t.next.id===n?t.next=t.next.next:t=t.next;this.tail.id===n&&(this.tail=t)}},r.clean=function(){this.head=null,this.tail=null},t=n,(e=[{key:"length",get:function(){for(var n=0,t=this.head;t;)n++,t=t.next;return n}}])&&f(t.prototype,e),o&&f(t,o),n}(),v=Object.prototype.hasOwnProperty;function y(n,t){return v.call(n,t)}function m(n){return Math.floor(Math.random()*n)}function k(n,t,e){var o;try{o=e?n.apply(t,e):n.call(t)}catch(n){console.error(n)}return o}function g(n){var t,e;n._map=new _,n._mapNode=null,n._deferred=(t=[],e=function(n){for(var e,o=p(t);!(e=o()).done;)if(e.value.uid===n.uid)return!0;return!1},{add:function(n){c(n)&&!e(n)&&t.push(n)},update:function(){for(var n in t)if(t.hasOwnProperty(n)){var e=t[n];c(e)&&e.update()}t=[]}})}function b(n,t,e){return n._map?n._map.find((function(n){return n.x===t&&n.y===e}),n):null}function $(n,t){S(n,t,"removeClass")}function w(n,t){S(n,t,"addSnakeColor")}function x(n,t){S(n,t,"addSnakeHeadColor")}function S(n,t,e){c(t)&&"function"==typeof t[e]&&(n._deferred.add(t),t[e]())}function C(){var n=d();return n.classList.add("snake-map__row"),n}function F(r){r._direction=t,r._step=!1,r._collision=!1,document.addEventListener("keydown",(function(i){!function(r,i){if(!r._step)return;switch(i.keyCode){case 38:case 87:A(r,n);break;case 39:case 68:A(r,t);break;case 40:case 83:A(r,e);break;case 37:case 65:A(r,o)}r._step=!1}(r,i)}))}function A(r,i){var a=!1;switch(i){case n:r._direction!==e&&(a=!0);break;case t:r._direction!==o&&(a=!0);break;case e:r._direction!==n&&(a=!0);break;case o:r._direction!==t&&(a=!0)}a&&(r._direction=i)}function M(n,t){this._init(n,t)}return function(n){n.prototype._init=function(n,t){var e=this;e.$el=function(n){if(s(n)){var t=document.querySelector(n);if(t)return t}else if(function(n){return!!n&&"object"==typeof n}(e=n)&&"nodeType"in e)return n;var e;return d("div")}(n),e.$options=function(n,t){var e,o={};for(e in n)r(e);for(e in t)y(n,e)||r(e);function r(e){o[e]=void 0===t[e]?n[e]:t[e]}return o}(r,t||{}),function(n){n._events=Object.create(null)}(e),g(e),function(n){n._snake=new _,n._lengthStartSnake=3,n.$on("render",n._renderSnake)}(e),function(n){n._foods=[],n._maxFoods=1,n.$on("render",n._renderFoods),n.$on("collision",n._collisionFoods)}(e),F(e),function(n){n._score=0,n._timeout=150,n._speed=1,n._pause=!0,n._interval=null,document.addEventListener("keydown",(function(t){!function(n,t){32==t.keyCode&&(n._pause?n.start():n.pause())}(n,t)}))}(e),e.$el&&e._mount(e.$el)}}(M),function(n){n.prototype.$on=function(n,t){var e=this;if(Array.isArray(n))for(var o=0,r=n.length;o<r;o++)e.$on(n[o],t);else(e._events[n]||(e._events[n]=[])).push(t);return e},n.prototype.$once=function(n,t){var e=this;function o(){e.$off(n,o),t.apply(e,arguments)}return o.fn=t,e.$on(n,o),e},n.prototype.$off=function(n,t){var e=this;if(!arguments.length)return e._events=Object.create(null),e;if(Array.isArray(n)){for(var o=0,r=n.length;o<r;o++)e.$off(n[o],t);return e}var i,a=e._events[n];if(!a)return e;if(!t)return e._events[n]=null,e;for(var s=a.length;s--;)if((i=a[s])===t||i.fn===t){a.splice(s,1);break}return e},n.prototype.$emit=function(n){var t=this,e=t._events[n];if(e){e=e.length>1?u(e):e;for(var o=u(arguments,1),r=0,i=e.length;r<i;r++)k(e[r],t,o)}return t}}(M),function(n){n.prototype._createMap=function(){var n=this;if(!n._map.length)for(var t=0;t<n.$options.rows;t++)for(var e=0;e<n.$options.columns;e++){var o=new a(e,t);n._map.append(o.uid,o)}return n._map},n.prototype._renderMap=function(){var n=this;if(!n._mapNode){for(var t=n._createMap().head,e=document.createDocumentFragment(),o=C(),r=n.$options.columns,i=0;t;)o.append(t.data.render()),++i==r&&(e.append(o),o=C(),i=0),t=t.next;n._mapNode=e}return n._mapNode}}(M),function(n){n.prototype._mount=function(n){n.append(this._render()),this._update()},n.prototype._render=function(){var n=this._renderMap();return this.$emit("render"),n},n.prototype._update=function(){this.$emit("update"),this._deferred.update()}}(M),function(n){n.prototype._renderSnake=function(){var n=this;if(!n._snake.length)for(var t=Math.ceil(n.$options.rows/2),e=Math.ceil(n.$options.columns/2),o=!0,r=0;r<n._lengthStartSnake;r++){var i=b(n,e-r,t);c(i)&&(o?(x(n,i),o=!1):w(n,i),n._snake.append(i.uid,i))}return n._snake}}(M),function(n){n.prototype._cleanFoods=function(){for(var n=this,t=0;t<n._foods.length;t++){var e=n._foods[t];c(e)&&$(n,e),n._foods.splice(t,1)}},n.prototype._cleanFood=function(n){for(var t=this,e=0;e<t._foods.length;e++){var o=t._foods[e];if(c(o)&&o.uid==n){$(t,o),t._foods.splice(e,1);break}}},n.prototype._renderFoods=function(){var n=this;n._foods=[];for(var t=0;t<n._maxFoods;t++){var e=n._renderFood();n._foods.push(e)}},n.prototype._renderFood=function(n){var t=this,e=b(t,m(t.$options.columns),m(t.$options.rows));return e&&t._getEmployedIds().indexOf(e.uid)<0?(function(n,t){S(n,t,"addFoodColor")}(t,e),n&&t._foods.push(e),e):t._renderFood(n)},n.prototype._collisionFoods=function(n){this._renderFood(!0),this._cleanFood(n)},n.prototype._getEmployedIds=function(){var n=this,t=[];return n._snake.length&&(t=[].concat(t,n._snake.toArray().map((function(n){return n.uid})))),n._foods.length&&(t=[].concat(t,n._foods.map((function(n){return n.uid})))),t}}(M),function(r){r.prototype._move=function(){var r=this,i=r._snake.head.data,a=function(r,i,a){var s=r._direction;switch(s){case n:case e:var u=s===n?a-1:a+1;return u>=r.$options.rows?u=0:u<0&&(u=r.$options.rows-1),b(r,i,u);case t:case o:var c=s===o?i-1:i+1;return c>=r.$options.columns?c=0:c<0&&(c=r.$options.columns-1),b(r,c,a)}return null}(r,i.x,i.y);(function(n,t){if(c(t)){return n._foods.map((function(n){return n.uid})).indexOf(t.uid)>=0}return!1})(r,a)&&(r.$emit("collision",a.uid),r._collision=!0),function(n,t){if(c(t)){if(n._snake.length>1&&n._snake.head){var e=n._snake.head.data;c(e)&&w(n,e)}x(n,t),n._snake.prepend(t.uid,t)}}(r,a),r._collision||function(n){if(n._snake.length){var t=n._snake.tail;c(t.data)&&($(n,t.data),n._snake.remove(t.id))}}(r),r._update(),r._collision=!1,r._step=!0}}(M),function(n){n.prototype.newGame=function(){this.$emit("newGame")},n.prototype.start=function(){var n=this;return function(n){n._score=0}(n),n._pause=!1,n._interval=setInterval((function(){n._move()}),function(n){return Math.max(20,n._timeout-50*n._speed)}(n))},n.prototype.pause=function(){var n=this;n._interval&&(clearInterval(n._interval),n._interval=null,n._pause=!0)}}(M),M}));

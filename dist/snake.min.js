!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).Snake=n()}(this,(function(){"use strict";var t=Object.prototype.hasOwnProperty;function n(n,e){return t.call(n,e)}function e(t){return Math.floor(Math.random()*t)}var o=1,r=2,a=3,i=4,s={rows:30,columns:40};function d(t){return"string"==typeof t}function u(t,n){n=n||0;for(var e=t.length-n,o=new Array(e);e--;)o[e]=t[e+n];return o}function f(t){return void 0===t&&(t="div"),d(t)&&t.length?document.createElement(t):null}function c(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var l=function(t,n,e){void 0===e&&(e=null),this.id=t,this.data=n,this.next=e},p=function(){function t(){this.head=null,this.tail=null}var n,e,o,r=t.prototype;return r.append=function(t,n){var e=new l(t,n);this.tail&&(this.tail.next=e),this.head||(this.head=e),this.tail=e},r.prepend=function(t,n){var e=new l(t,n,this.head);this.head=e,this.tail||(this.tail=e)},r.find=function(t,n){if(void 0===n&&(n=null),!this.head||"function"!=typeof t)return null;for(var e=this.head;e;){try{if(t.apply(n,[e.data,e.id]))return e.data}catch(t){console.error(t)}e=e.next}return null},r.toArray=function(){var t=[];return this.for((function(n){t.push(n)}),this),t},r.for=function(t,n){if(void 0===n&&(n=null),this.head&&"function"==typeof t)for(var e=this.head;e;){try{t.apply(n,[e.data,e.id])}catch(t){console.error(t)}e=e.next}},r.filter=function(t,n){void 0===n&&(n=null);var e=[];if("function"!=typeof t)return e;for(var o=this.head;o;){try{t.apply(n,[o.data,o.id])&&e.push(o.data)}catch(t){console.error(t)}o=o.next}return e},r.remove=function(t){if(this.head){for(;this.head&&this.head.id===t;)this.head=this.head.next;for(var n=this.head;n&&n.next;)n.next.id===t?n.next=n.next.next:n=n.next;this.tail.id===t&&(this.tail=n)}},r.clean=function(){this.head=null,this.tail=null},n=t,(e=[{key:"length",get:function(){for(var t=0,n=this.head;n;)t++,n=n.next;return t}}])&&c(n.prototype,e),o&&c(n,o),t}();function h(t,n,e){var o;try{o=e?t.apply(n,e):t.call(n)}catch(t){console.error(t)}return o}var _=0,v=function(){function t(t,n){this.x=t,this.y=n,this.uid=_++,this.node=null,this.oldClass="snake-map__col",this.class=this.oldClass,this.update()}var n=t.prototype;return n.render=function(){if(!this.node){var t=f();t.classList.add(this.oldClass),this.node=t}return this.node},n.update=function(){this.oldClass!==this.class&&(this.render().classList=this.class,this.oldClass=this.class)},n.addSnakeColor=function(){this.class="snake-map__col snake-map__col--snake"},n.addSnakeHeadColor=function(){this.class="snake-map__col snake-map__col--snake-head"},n.addFoodColor=function(){this.class="snake-map__col snake-map__col--food"},n.removeClass=function(){this.class="snake-map__col"},t}();function y(t){var n;t._map=new p,t._mapNode=null,t._deferred=(n=[],{add:function(t){n.push(t)},update:function(){for(var t in n)if(n.hasOwnProperty(t)){var e=n[t];e instanceof v&&e.update()}n=[]}}),t.$on("update",t._deferred.update)}function m(t,n,e){return t._map?t._map.find((function(t){return t.x===n&&t.y===e}),t):null}function k(){var t=f();return t.classList.add("snake-map__row"),t}function g(t,n){this._init(t,n)}return function(t){t.prototype._init=function(t,e){var o=this;o.$el=function(t){if(d(t)){var n=document.querySelector(t);if(n)return n}else if(function(t){return!!t&&"object"==typeof t}(e=t)&&"nodeType"in e)return t;var e;return f("div")}(t),o.$options=function(t,e){var o,r={};for(o in t)a(o);for(o in e)n(t,o)||a(o);function a(n){r[n]=void 0===e[n]?t[n]:e[n]}return r}(s,e||{}),function(t){t._events=Object.create(null)}(o),y(o),function(t){t._snake=new p,t._lengthStartSnake=3,t.$on("update",t._updateSnake)}(o),function(t){t._foods=[],t._maxFoods=1}(o),function(t){t._direction=r}(o),o.$el&&o._mount(o.$el)}}(g),function(t){t.prototype.$on=function(t,n){var e=this;if(Array.isArray(t))for(var o=0,r=t.length;o<r;o++)e.$on(t[o],n);else(e._events[t]||(e._events[t]=[])).push(n);return e},t.prototype.$once=function(t,n){var e=this;function o(){e.$off(t,o),n.apply(e,arguments)}return o.fn=n,e.$on(t,o),e},t.prototype.$off=function(t,n){var e=this;if(!arguments.length)return e._events=Object.create(null),e;if(Array.isArray(t)){for(var o=0,r=t.length;o<r;o++)e.$off(t[o],n);return e}var a,i=e._events[t];if(!i)return e;if(!n)return e._events[t]=null,e;for(var s=i.length;s--;)if((a=i[s])===n||a.fn===n){i.splice(s,1);break}return e},t.prototype.$emit=function(t){var n=this,e=n._events[t];if(e){e=e.length>1?u(e):e;for(var o=u(arguments,1),r=0,a=e.length;r<a;r++)h(e[r],n,o)}return n}}(g),function(t){t.prototype._createMap=function(){var t=this;if(!t._map.length)for(var n=0;n<t.$options.rows;n++)for(var e=0;e<t.$options.columns;e++){var o=new v(e,n);t._map.append(o.uid,o)}return t._map},t.prototype._renderMap=function(){var t=this;if(!t._mapNode){for(var n=this._createMap().head,e=document.createDocumentFragment(),o=k(),r=0;n;)r!==n.data.y&&(r=n.data.y,e.append(o),o=k()),o.append(n.data.render()),n=n.next;t._mapNode=e}return t._mapNode}}(g),function(t){t.prototype._mount=function(t){t.append(this._render()),this._update()},t.prototype._render=function(){var t=this,n=t._renderMap();return t._renderSnake(),t._renderFoods(),n},t.prototype._update=function(){this.$emit("update")}}(g),function(t){t.prototype._renderSnake=function(){var t=this;if(!t._snake.length)for(var n=Math.ceil(t.$options.rows/2),e=Math.ceil(t.$options.columns/2),o=!0,r=0;r<t._lengthStartSnake;r++){var a=m(t,e-r,n);a instanceof v&&(o?(a.addSnakeHeadColor(),o=!1):a.addSnakeColor(),t._deferred.add(a),t._snake.append(a.uid,a))}return t._snake},t.prototype._updateSnake=function(){if(this._snake.length){var t=!0;this._snake.for((function(n){t?(n.addSnakeHeadColor(),t=!1):n.addSnakeColor(),n.update()}))}}}(g),function(t){t.prototype._cleanFoods=function(){for(var t=this,n=0;n<t._foods.length;n++){var e=t._foods[n];e instanceof v&&(e.removeClass(),t._deferred.add(e)),t._foods.splice(n,1)}},t.prototype._renderFoods=function(){var t=this;t._foods=[];for(var n=0;n<t._maxFoods;n++){var e=this._renderFood();t._foods.push(e)}},t.prototype._renderFood=function(t){var n=this,o=m(n,e(n.$options.columns),e(n.$options.rows));return o&&n._getEmployedIds().indexOf(o.uid)<0?(o.addFoodColor(),n._deferred.add(o),t&&n._foods.push(o),o):n._renderFood()},t.prototype._getEmployedIds=function(){var t=this,n=[];return t._snake.length&&(n=[].concat(n,t._snake.toArray().map((function(t){return t.uid})))),t._foods.length&&(n=[].concat(n,t._foods.map((function(t){return t.uid})))),n}}(g),function(t){t.prototype._move=function(){var t=this,n=t._snake.head.data,e=function(t,n,e){var s=t._direction;switch(s){case o:case a:var d=s===o?e-1:e+1;return d>=t.$options.rows&&(d=0),m(t,n,d);case r:case i:var u=s===i?n-1:n+1;return u>=t.$options.columns&&(u=0),m(t,u,e)}return null}(t,n.x,n.y);e instanceof v&&t._snake.prepend(e.uid,e),function(t){if(t._snake.length){var n=t._snake.tail;n.data instanceof v&&(n.data.removeClass(),t._deferred.add(n.data),t._snake.remove(n.id))}}(t),t._update()}}(g),g}));
